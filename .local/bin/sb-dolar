#!/bin/sh
file="$HOME/.local/share/dolar"

setvar(){
	compra=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | head -n1)
	venta=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "2p")
	bluecompra=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "3p")
	blueventa=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | tail -n1)
}

update(){
	curl -s "https://dolarhoy.com/cotizaciondolaroficial" > "$file"
	curl -s "https://dolarhoy.com/cotizaciondolarblue" >> "$file"
	setvar
}

setvar

case $BLOCK_BUTTON in
	1) [ -z "$blueventa" ] || notify-send \
"ğŸ’µ Oficial ğŸ’µ
Compra: \$$compra
Venta:  \$$venta
ğŸ’µ Blue ğŸ’µ
Compra: \$$bluecompra 
Venta:  \$$blueventa" ;;
	2) update ;;
	3) "$TERMINAL" -e "$EDITOR" "$0";;
esac

[ "$(stat -c %y "$file" | cut -d' ' -f1)" !=  "$(date -I)" ] && update

[ -z "$blueventa" ] || echo " $blueventa"
