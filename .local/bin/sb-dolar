#!/bin/sh
file="$HOME/.local/share/dolar"

setvar(){
	compra=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | head -n1)
	venta=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "2p")

	bluecompra=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "3p")
	blueventa=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "4p")

	mepcompra=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "5p")
	mepventa=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | sed -n "6p")

	solidario=$(grep -Eo "\"value\".{20}" "$file" | grep -Eo "[0-9]*\.[0-9]*" | tail -n1)
}

update(){
	curl -s "https://dolarhoy.com/cotizaciondolaroficial" > "$file"
	curl -s "https://dolarhoy.com/cotizaciondolarblue" >> "$file"
	curl -s "https://dolarhoy.com/cotizaciondolarbolsa" >> "$file"
	curl -s "https://dolarhoy.com/cotizaciondolarsolidario" >> "$file"
	setvar
}

setvar

case $BLOCK_BUTTON in
	1) [ -z "$blueventa" ] || notify-send "ğŸ’µ Oficial ğŸ’µ" \
"Compra: <b>\$</b><b><span fgcolor=\"yellow\">$compra</span></b>
Venta:  <b>\$</b><b><span fgcolor=\"yellow\">$venta</span></b>

ğŸ’µ <b>Blue</b> ğŸ’µ
Compra: <b>\$</b><b><span fgcolor=\"yellow\">$bluecompra </span></b>
Venta:  <b>\$</b><b><span fgcolor=\"yellow\">$blueventa</span></b>

ğŸ’µ <b>Mep</b> ğŸ’µ
Compra: <b>\$</b><b><span fgcolor=\"yellow\">$mepcompra </span></b>
Venta:  <b>\$</b><b><span fgcolor=\"yellow\">$mepventa</span></b>

ğŸ’µ <b>Solidario</b> ğŸ’µ
Venta:  <b>\$</b><b><span fgcolor=\"yellow\">$solidario</span></b>" ;;
	2) update ;;
	3) "$TERMINAL" -e "$EDITOR" "$0";;
esac

[ "$(stat -c %y "$file" | cut -d' ' -f1)" !=  "$(date -I)" ] && update

[ -z "$blueventa" ] || echo " $blueventa"
