#!/bin/bash

file="${XDG_CACHE_HOME:-$HOME/.cache}/newsboat/nbimg.jpg"

pgrep -fx "wget -O "$file" .*" > /dev/null && exit 1

if [[ "$1" =~ https?://imgur.com/.* ]]
then
	url="$(echo $1.jpg | sed "s/\/i/\/i\.i/")"
elif [[ "$1" =~ .*watch\?v=.{11}$ ]] || [[ "$1" =~ .*youtu\.be/.* ]]
then
	url="$(yt-dlp --skip-download --get-thumbnail "$1")"
else
	url="$1"
fi

curl -sL "$url" -o "$file" 2> /dev/null || ( notify-send "Error" && rm $file && exit 1 )

(pgrep -f "sxiv -pab $file" > /dev/null && exit) || (sxiv -pab $file 2>/dev/null && rm $file)
